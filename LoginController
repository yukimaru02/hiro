package hiro.shitanda.yuki.controller;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.SessionAttributes;

import hiro.shitanda.yuki.dao.LoginDAO;
import hiro.shitanda.yuki.entity.Login;

@Controller
@SessionAttributes("loginModel")
@RequestMapping("login")
public class LoginController {
	
	@ModelAttribute("loginModel")
	public Login setUpLoginForm() {
		return new Login(); 
	}
	
	private static ApplicationContext context = new ClassPathXmlApplicationContext("spring.xml");
	
	//@SuppressWarnings("unchecked")
	private static LoginDAO loginDAO = (LoginDAO)context.getBean("loginDAO");

	@RequestMapping(method=RequestMethod.GET)
	public String toLogin() {
		return "loginForm";
	}
	
	@RequestMapping(method=RequestMethod.POST)
	public String toHome(@ModelAttribute Login loginModel,Model model) {
		String user_id = loginModel.getUser_id();
		String password = loginModel.getPassword();
		Login login = loginDAO.checkUser(user_id, password);
		
		if(login == null) {
			model.addAttribute("errorMessage","ユーザーIDもしくはパスワードが異なります");
			return "loginForm";
		}else if((login.getUser_id()).equals("h-shitanda")){
			loginModel = login;
			return "redirect:/home";
		}else {
			model.addAttribute("errorMessage","なかなかうまくいかないね");
			return "loginForm";
		}
	}
	
	
}
